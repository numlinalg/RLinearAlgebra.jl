<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tracking · RLinearAlgebra</title><meta name="title" content="Tracking · RLinearAlgebra"/><meta property="og:title" content="Tracking · RLinearAlgebra"/><meta property="twitter:title" content="Tracking · RLinearAlgebra"/><meta name="description" content="Documentation for RLinearAlgebra."/><meta property="og:description" content="Documentation for RLinearAlgebra."/><meta property="twitter:description" content="Documentation for RLinearAlgebra."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">RLinearAlgebra</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../cls_overview/">Consistent Linear Systems</a></li><li class="is-active"><a class="tocitem" href>Tracking</a><ul class="internal"><li><a class="tocitem" href="#The-need-for-tracking"><span>The need for tracking</span></a></li><li><a class="tocitem" href="#Understanding-how-to-use-the-estimator"><span>Understanding how to use the estimator</span></a></li><li><a class="tocitem" href="#Stopping"><span>Stopping</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/linear_rsolve/">Randomized Linear Solvers</a></li><li><a class="tocitem" href="../../api/linear_samplers/">Linear Samplers</a></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Linear Subsolvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/linear_solver_routines/">Main Solvers</a></li><li><a class="tocitem" href="../../api/linear_solver_helpers/">Solver Helpers</a></li></ul></li><li><a class="tocitem" href="../../api/linear_solver_logs/">Linear Solver Logs</a></li><li><a class="tocitem" href="../../api/linear_solver_stops/">Linear Solver Stop Criteria</a></li><li><a class="tocitem" href="../../api/low_rank_approximations/">Low Rank Approximations</a></li><li><a class="tocitem" href="../../api/low_rank_approximation_error/">Low Rank Approximation Error Methods</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Tracking</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tracking</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/numlinalg/RLinearAlgebra.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/numlinalg/RLinearAlgebra.jl/blob/master/docs/src/man/tracking_overview.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tracking-an-Iterative-Sketching-Solver"><a class="docs-heading-anchor" href="#Tracking-an-Iterative-Sketching-Solver">Tracking an Iterative Sketching Solver</a><a id="Tracking-an-Iterative-Sketching-Solver-1"></a><a class="docs-heading-anchor-permalink" href="#Tracking-an-Iterative-Sketching-Solver" title="Permalink"></a></h1><p>***Here we describe a tracking procedure for the row sketching method. The same descriptions and instructions also apply for the column sketching methods, but use the residual of the normal equations rather than the residual of the linear system***</p><h2 id="The-need-for-tracking"><a class="docs-heading-anchor" href="#The-need-for-tracking">The need for tracking</a><a id="The-need-for-tracking-1"></a><a class="docs-heading-anchor-permalink" href="#The-need-for-tracking" title="Permalink"></a></h2><p>When using an iterative row sketching method like Randomized Block Kaczmarz to find a <span>$x^*$</span> such that <span>$Ax^*=b$</span> for <span>$A\in \mathbb{R}^{m\times n}$</span>, <span>$b\in \mathbb{R}^n$</span>, knowing the quality of the solution is integral for being able to make appropriate stopping decisions. This solution quality can be determined by progress tracking procedures, the most common one being computing the norm squared of the residual of the linear system, <span>$\|Ax_k-b\|_2^2$</span>. Without careful thought progress tracking can undermine the benefits of the iterative sketching procedure. For instance, the update to the sketch is computed using only a sketch of the matrix, <span>$SA \in \mathcal{R}^{p \times n}$</span>, <span>$p \ll m$</span>, and constant vector <span>$Sb \in \mathcal{R}^p$</span>; however, the residual computation requires the accessing the full matrix <span>$A$</span> to compute. This completely undermines the memory benefits of working with the smaller sketch. Additionally, if <span>$p \ll \sqrt{m}$</span>, which is often the case in practice we can see in the table below that the computational complexity of the update is less than computing the residual.</p><table><tr><th style="text-align: right">Action</th><th style="text-align: right">Cost</th><th style="text-align: center">Accesses to Full Matrix</th></tr><tr><td style="text-align: right">Update</td><td style="text-align: right"><span>$\mathcal{O}(np^2)$</span></td><td style="text-align: center">0</td></tr><tr><td style="text-align: right">Residual</td><td style="text-align: right"><span>$\mathcal{O}(nm)$</span></td><td style="text-align: center">1</td></tr><tr><td style="text-align: right">Sketched MA</td><td style="text-align: right"><span>$\mathcal{O}(np)$</span></td><td style="text-align: center">0</td></tr></table><p>These cost could be avoided by computing the sketched residual, i.e. <span>$\|S A x - Sb\|_2^2$</span>, but at the cost exact knowledge of  progress. To reduce this randomness Pritchard and Patel propose using  a moving average of the sketched residuals in <a href="https://arxiv.org/abs/2201.05741">&quot;Solving, Tracking  and Stopping Streaming Linear Inverse Problems.&quot;</a> Specifically they define the progress estimator  $     \hat \rho<em>k^\lambda = \sum</em>{i-\lambda +1}^k \frac{\|S<em>i A x - S</em>ib\|_2^2}{\lambda}, $   where <span>$\lambda$</span> is the width of the moving average window. </p><p>This tracking technique can be used in RLinearAlgebra.jl with the log option <a href="../../api/linear_solver_logs/#RLinearAlgebra.LSLogMA"><code>LSLogMA()</code></a> when defining the solver, with a default moving average width of 30.</p><pre><code class="language-julia hljs">using RLinearAlgebra

# Generate a system
A = rand(20, 5);
x = rand(5);
b = A * x;

# Specify solver
solver = RLSSolver(
    LinSysVecRowRandCyclic(),   # Random Cyclic Sampling
    LinSysVecRowProjStd(),      # Hyperplane projection
    LSLogMA(),              # Full Logger: maintains moving average residual history
    LSStopMaxIterations(200),   # Maximum iterations stopping criterion
    nothing                     # System solution (not solved yet)
);

# Solve the system
sol = rsolve(solver, A, b)</code></pre><h2 id="Understanding-how-to-use-the-estimator"><a class="docs-heading-anchor" href="#Understanding-how-to-use-the-estimator">Understanding how to use the estimator</a><a id="Understanding-how-to-use-the-estimator-1"></a><a class="docs-heading-anchor-permalink" href="#Understanding-how-to-use-the-estimator" title="Permalink"></a></h2><p>The user is able to choose their own width of the moving average by inputting  <code>lambda2=USER_WIDTH</code> as an option within <a href="../../api/linear_solver_logs/#RLinearAlgebra.LSLogMA"><code>LSLogMA()</code></a>. Increasing the width will decrease the variability of the progress estimate and therefore is a suggested action when the matrix is poorly conditioned or has highly variable magnitude of row  norms. However, in most cases the default option of 30 should be  sufficient for reasonable tracking. </p><p>In most cases, it is desirable to in fact use two widths for  the moving average estimator because often at early iterations much of the observed variability in the residuals arises from the  fast convergence of the algorithm. As this variability is primarily because of convergence properties rather than randomness, it is undesirable to smooth this out. Thus, it makes  sense in this phase to use a smaller moving average width, <span>$\lambda_1$</span>, which should typically be set to 1 (the user can change using the option <code>lambda1=SMALLER_WIDTH</code> in <a href="../../api/linear_solver_logs/#RLinearAlgebra.LSLogMA"><code>LSLogMA()</code></a>). Once the  algorithm leaves this fast convergence phase it, then the wider moving average window should be used. This switch is determined to be the point where there is no longer monotonic decreases in the norm of the sketched residual. </p><p>If the user wants to compare the performance of the moving average of the sketched residuals to  that of the true residuals then it is possible to input the option <code>true_res=true</code> into <a href="../../api/linear_solver_logs/#RLinearAlgebra.LSLogMA"><code>LSLogMA()</code></a>. This will  perform the same moving average tracking procedure, but use the true residual rather than the sketched one.</p><p>Finally, if the user wants to get uncertainty sets for the sketched residual tracking they can use the function <a href="../../api/linear_solver_logs/#RLinearAlgebra.get_uncertainty-Tuple{LSLogMA}"><code>get_uncertainty()</code></a>, whose use is demonstrated below.  For the uncertainty sets, the user can specify <code>alpha</code>, which indicates the probability that the moving average of the  true residuals falls within outputted interval. </p><p>As an example the user wanted to track a standard row solver  with a moving average of the sketched residuals of width 100 and get a 99% uncertainty sets they could run the following code.  </p><pre><code class="language-julia hljs">
using RLinearAlgebra

# Generate a system
A = rand(20, 5);
x = rand(5);
b = A * x;

# Specify solver
solver = RLSSolver(
    LinSysVecRowRandCyclic(),   # Random Cyclic Sampling
    LinSysVecRowProjStd(),      # Hyperplane projection
    LSLogMA(lambda_2 = 100),    # Full Logger: maintains moving average residual history
    LSStopMaxIterations(200),   # Maximum iterations stopping criterion
    nothing                     # System solution (not solved yet)
);

# Solve the system
sol = rsolve(solver, A, b)
bounds = get_uncertainty(sol.log, alpha = .99)</code></pre><p><strong>Note: If the user is using a subset of identity type sampling method these uncertainty sets will perform conservatively     because of a poor variance estimate. The user can reduce this conservativeness using the option <span>$\eta=w$</span> in      the <a href="../../api/linear_solver_logs/#RLinearAlgebra.LSLogMA"><code>LSLogMA()</code></a> settings for the solver, where w is a positive real number that divides the estimated variance of the set.</strong></p><h2 id="Stopping"><a class="docs-heading-anchor" href="#Stopping">Stopping</a><a id="Stopping-1"></a><a class="docs-heading-anchor-permalink" href="#Stopping" title="Permalink"></a></h2><p>In addition to being able to form the uncertainty sets, Pritchard and Patel also proposed a criterion for stopping when using the sketched moving average estimator. <code>RLinearAlgebra.jl</code> allows for the specification  these methods this can be done using <a href="../../api/linear_solver_stops/#RLinearAlgebra.LSStopMA"><code>LSStopMA()</code></a>. To understand the stopping criterion, it is valuable to define some notation. If we allow <span>$\rho_k^\lambda$</span> be the moving average of the true residuals, and  <span>$\hat \rho_k^\lambda$</span> be the moving average of the sketched residuals then two types of errors can occur.  </p><p>The first can be viewed as stopping too late, and it occurs when the tracking parameter value,  <span>$\rho_k^\lambda \leq \delta_I \upsilon$</span>, while <span>$\hat \rho_k^\lambda &gt; \upsilon$</span>, where <span>$\delta_I$</span>  is a user defined parameter that indicates a &quot;meaningful gap&quot; between <span>$\hat \rho_k^\lambda$</span>  and <span>$\rho_k^\lambda$</span>. </p><p>The second error type can be viewed as stopping too early, and it occurs when the tracking parameter value,  <span>$\rho_k^\lambda \geq \delta_{II} \upsilon$</span>, while <span>$\hat \rho_k^\lambda &lt; \upsilon$</span>. Where <span>$\delta_{II}$</span> is a user defined parameter that indicates a &quot;meaningful gap&quot; between <span>$\hat \rho_k^\lambda$</span> and <span>$\rho_k^\lambda$</span>. </p><p>Using <code>LSStopMA()</code> ensures that neither of these errors occurs more than the user specified rates <span>$\xi_{I}$</span> and <span>$\xi_{II}$</span>. Where <span>$\xi_{I}$</span> is the upper bound on the probability  the solver is stopped too late and <span>$\xi_{II}$</span> is an upper bound on the probability that the solver is stopped too early.</p><p>The options for these stopping criterion parameters are represented by the options <span>$\delta_I =$</span> <code>delta1</code>, <span>$\delta_{II} = $ `delta2`, $\xi_I =$</span> <code>chi1</code>, <span>$\xi_{II}=$</span> <code>chi2</code>, and <span>$\upsilon=$</span> <code>upsilon</code>. By default, <code>upsilon=1e-10</code>, <code>delta1=.9</code>, <code>delta2=1.1</code>, <code>chi_I = .01</code>, <code>chi_{II} = .01</code>. To use the stopping criterion, the user must input a max number of iterations, and specify changes to the default settings as options. So for instance if one wanted to use the stopping criterion with a  maximum iteration of 1000 and <code>upsilon = 1e-3</code>, the following code could be used. </p><pre><code class="language-julia hljs">
using RLinearAlgebra

# Generate a system
A = rand(20, 5);
x = rand(5);
b = A * x;

# Specify solver
solver = RLSSolver(
    LinSysVecRowRandCyclic(),       # Random Cyclic Sampling
    LinSysVecRowProjStd(),          # Hyperplane projection
    LSLogMA(lambda_2 = 100),        # Full Logger: maintains moving average residual history
    LSStopMA(1000, upsilon=1e-3),   # Maximum iterations stopping criterion
    nothing                         # System solution (not solved yet)
);

# Solve the system
sol = rsolve(solver, A, b)
bounds = get_uncertainty(sol.log, alpha = .99)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../cls_overview/">« Consistent Linear Systems</a><a class="docs-footer-nextpage" href="../../api/linear_rsolve/">Randomized Linear Solvers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 7 November 2024 09:18">Thursday 7 November 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
